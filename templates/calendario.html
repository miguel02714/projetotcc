<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="utf-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0095FF">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <title>Agenda | Brain Boost</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.4.47/css/materialdesignicons.min.css">
<style>
    /* ... (Todos os seus estilos CSS anteriores estão aqui) ... */
    
    /* ======================================= */
    /* == ESTILOS GERAIS E LAYOUT PRINCIPAL == */
    /* ======================================= */

    :root {
        /* Paleta de Cores Primária */
        --color-dark-blue: #0A1428; /* Fundo Principal */
        --color-medium-blue: #1A345C; /* Fundo do Navbar/Destaque */
        --color-light-blue: #00A6FF; /* Principal (Acento) */
        --color-yellow: #FFC74F; 
        --color-blue-card: #1D547B; 
        --color-green-card: #2ECC71; 
        --color-red-card: #E74C3C; /* Novo para tarefas Urgentes */
        --color-white: #FFFFFF;
        --color-text-light: rgba(255, 255, 255, 0.95);
        --color-text-faded: rgba(255, 255, 255, 0.5);

        /* Tipografia */
        --font-main: 'Poppins', sans-serif;
        --font-size-base: 1rem;
        --font-size-small: clamp(0.75rem, 2vw, 0.875rem);
        --font-size-large: clamp(1.2rem, 5vw, 1.8rem);
    }

    /* BASE E LINKS */
    body {
        background-color: var(--color-dark-blue);
        font-family: var(--font-main);
        color: var(--color-text-light);
        margin: 0;
        padding: 0;
        /* Padding inferior para o toolbar */
        padding-bottom: clamp(75px, 15vh, 95px); 
        min-height: 100vh;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    /* Reset e Transições de Click */
    * {
        box-sizing: border-box;
    }

    a {
        color: var(--color-light-blue);
        text-decoration: none;
        transition: opacity 0.2s ease, transform 0.1s ease;
    }
    
    a:active {
        transform: scale(0.98);
    }

    .page-content {
        padding: 0 clamp(15px, 4vw, 25px);
        padding-top: 15px; 
        max-width: 520px;
        margin: 0 auto;
    }
    
    h1 {
        font-size: var(--font-size-large);
        font-weight: 700;
        color: var(--color-text-light);
        margin-top: 0;
        margin-bottom: 25px;
        text-align: center;
    }
    
    /* SCROLLBAR CLEAN (do código anterior) */
    ::-webkit-scrollbar {
        width: 8px;
    }
    ::-webkit-scrollbar-track {
        background: #111b33;
    }
    ::-webkit-scrollbar-thumb {
        background: var(--color-medium-blue);
        border-radius: 10px;
    }

    /* TOP NAVIGATION (Copiado do código anterior) */
    .top-nav {
        height: clamp(65px, 15vh, 85px);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 15px;
        position: relative;
    }

    .logo-app {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        width: clamp(100px, 25vw, 140px);
        top: 50%;
        transform: translate(-50%, -50%);
        z-index: 5;
    }
    
    .logo-app img {
        display: block;
        width: 100%;
    }

    .btn-acao-topo {
        font-size: clamp(26px, 6vw, 34px);
        z-index: 10;
        line-height: 1;
        display: flex;
        align-items: center;
        margin-left: auto;
    }

    .btn-acao-topo i {
        color: var(--color-light-blue);
        transition: color 0.2s ease;
        padding-left: 15px;
    }

    .btn-acao-topo .ri-logout-box-r-line {
        color: #FF6347;
    }
    
    /* TOOLBAR INFERIOR (Copiado do código anterior) */
    .toolbar {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: clamp(65px, 12vh, 85px);
        background: transparent;
        z-index: 100;
        padding-top: 10px;
    }

    .toolbar-inner {
        background: var(--color-medium-blue);
        border-radius: 50px;
        height: clamp(55px, 9vh, 70px); 
        margin: 0 10px;
        box-shadow: 0 -6px 20px rgba(0, 0, 0, 0.4);
        display: flex;
        justify-content: space-around;
        align-items: center;
    }

    .toolbar-link {
        flex: 1;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: var(--color-text-faded);
        font-weight: 500;
        transition: color 0.2s ease, transform 0.1s ease;
    }

    .toolbar-link.active {
        color: var(--color-light-blue);
        font-weight: 700;
    }

    .toolbar-link i {
        font-size: clamp(24px, 5vw, 32px);
        line-height: 1;
    }

    .toolbar-link span {
        display: none; 
    }

    /* ======================================= */
    /* ========== ESTILOS DO CALENDÁRIO ====== */
    /* ======================================= */
    .calendar-container {
        background: var(--color-medium-blue);
        border-radius: 16px; 
        padding: 15px;
        margin-bottom: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }

    .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        font-weight: 600;
        font-size: clamp(1rem, 4vw, 1.2rem);
    }

    .calendar-header i {
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--color-light-blue);
        transition: transform 0.1s ease;
    }
    
    .calendar-header i:active {
        transform: scale(0.9);
    }
    
    .calendar-days-name {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        text-align: center;
        font-size: var(--font-size-small);
        color: var(--color-text-faded);
        font-weight: 600;
        padding-bottom: 10px;
    }

    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
        text-align: center;
    }

    .day-cell {
        padding: 8px 0;
        font-size: var(--font-size-base);
        font-weight: 500;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.2s, transform 0.1s;
    }
    
    .day-cell:not(.other-month):hover {
        background-color: rgba(255, 255, 255, 0.1);
    }
    
    .day-cell:active {
        transform: scale(0.95);
    }

    /* Estilo para dias de outro mês */
    .day-cell.other-month {
        opacity: 0.3;
        pointer-events: none;
    }

    /* Estilo para dia selecionado */
    .day-cell.selected {
        background-color: var(--color-light-blue);
        color: var(--color-dark-blue);
        font-weight: 700;
    }

    /* Estilo para dia com evento */
    .day-cell.has-event {
        border-bottom: 3px solid var(--color-yellow);
        padding-bottom: 5px; /* Ajusta o padding para a barra aparecer */
    }

    /* ======================================= */
    /* ========= LISTA DE TAREFAS ============ */
    /* ======================================= */
    .section-header {
        font-size: clamp(1rem, 4vw, 1.2rem);
        font-weight: 600;
        margin-bottom: 15px;
        color: var(--color-light-blue);
    }

    .task-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .task-item {
        background: var(--color-medium-blue);
        padding: 15px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .task-details {
        flex-grow: 1;
    }

    .task-details p {
        margin: 0;
        font-weight: 600;
        font-size: var(--font-size-base);
        line-height: 1.2;
    }

    .task-details span {
        font-size: var(--font-size-small);
        color: var(--color-text-faded);
    }

    .task-due {
        font-weight: 700;
        color: var(--color-yellow);
        font-size: var(--font-size-small);
        text-align: right;
        flex-shrink: 0;
    }

    /* Prioridades */
    .task-item.urgent { border-left: 5px solid var(--color-red-card); }
    .task-item.important { border-left: 5px solid var(--color-yellow); }
    .task-item.normal { border-left: 5px solid var(--color-green-card); }

    .task-checkbox i {
        font-size: 1.8rem;
        color: var(--color-text-faded);
        transition: color 0.2s;
        cursor: pointer;
        margin-left: 15px;
    }

    .task-checkbox i.completed {
        color: var(--color-green-card);
    }
    
    /* Botão de Ação Flutuante (FAB) */
    .fab {
        position: fixed;
        bottom: clamp(90px, 18vh, 120px); /* Acima do navbar */
        right: 25px;
        background-color: var(--color-light-blue);
        color: var(--color-dark-blue);
        width: 56px;
        height: 56px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        z-index: 90;
        transition: transform 0.2s ease;
    }

    .fab:active {
        transform: scale(0.95);
    }

    /* Estilos para o Modal/Formulário de Adição de Tarefa */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        z-index: 200;
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
    }

    .modal-overlay.active {
        opacity: 1;
        pointer-events: auto;
    }

    .modal-content {
        background-color: var(--color-medium-blue);
        padding: 30px;
        border-radius: 15px;
        width: 90%;
        max-width: 400px;
        transform: translateY(20px);
        transition: transform 0.3s ease;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    .modal-overlay.active .modal-content {
        transform: translateY(0);
    }

    .modal-content h3 {
        color: var(--color-light-blue);
        margin-top: 0;
        margin-bottom: 20px;
        font-size: 1.3rem;
    }

    .modal-content input,
    .modal-content select {
        width: 100%;
        padding: 12px;
        margin-bottom: 15px;
        border-radius: 8px;
        border: 1px solid #3A5A7F;
        background-color: #0A1428;
        color: var(--color-text-light);
        font-size: var(--font-size-base);
    }

    .modal-content button {
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: opacity 0.2s;
        width: 100%;
    }

    .modal-content button.btn-add {
        background-color: var(--color-light-blue);
        color: var(--color-dark-blue);
        margin-top: 10px;
    }

    .modal-content button.btn-cancel {
        background-color: #555;
        color: var(--color-white);
    }
    
    .modal-content .button-group {
        display: flex;
        gap: 10px;
    }
    
    .modal-content .button-group button {
        flex: 1;
    }
</style>

</head>

<body>
    <div id="app">

        <div class="view view-main">

            <<div class="toolbar toolbar-bottom">
                <nav class="toolbar-inner display-flex">

                    <a href="{{ url_for('inicio') }}" class="toolbar-link active-home" aria-label="Início">
                        <i class="ri-home-5-fill"></i> <span>Home</span>
                    </a>

                    

                    <a href="{{ url_for('quizboost') }}" class="toolbar-link" aria-label="Jogos">
                        <i class="ri-gamepad-fill"></i>
                        <span>Jogos</span>
                    </a>

                    <a href="{{ url_for('calendario') }}" class="toolbar-link" aria-label="Agenda">
                        <i class="ri-calendar-todo-fill"></i>
                        <span>Agenda</span>
                    </a>
                    
                    <a href="{{ url_for('relaxar') }}" class="toolbar-link" aria-label="Relaxar">
                        <i class="ri-timer-2-fill"></i>
                        <span>Relaxar</span>
                    </a>
                </nav>
            </div>
            
            <div data-name="agenda" class="page color-theme-blue">
                <header class="top-nav">
                    <div class="logo-app">
                        <img src="https://i.postimg.cc/3w4kZB8V/logo.png" alt="Brain Boost Logo">
                    </div>
                    
                    <div class="btn-acao-topo">
                        {% if current_user.is_authenticated %}
                            <a href="{{ url_for('editar_usuario', id_usuario=current_user.id_usuario) }}" aria-label="Perfil">
                                <i class="mdi mdi-account"></i>
                            </a>
                            <a href="{{ url_for('logout') }}" aria-label="Sair">
                                <i class="ri-logout-box-r-line"></i> 
                            </a>
                        {% else %}
                            <a href="{{ url_for('loginentrar') }}" aria-label="Fazer Login">
                                <i class="ri-account-circle-fill"></i>
                            </a>
                        {% endif %}
                    </div>
                </header>
                
                <main class="page-content">
                    
                    <h1><i class="ri-calendar-todo-line"></i> Minha Agenda</h1>

                    <section class="calendar-container">
                        <div class="calendar-header">
                            <i class="ri-arrow-left-s-line" id="prevMonth"></i>
                            <span id="currentMonthYear">Novembro 2025</span>
                            <i class="ri-arrow-right-s-line" id="nextMonth"></i>
                        </div>
                        <div class="calendar-days-name">
                            <span>D</span>
                            <span>S</span>
                            <span>T</span>
                            <span>Q</span>
                            <span>Q</span>
                            <span>S</span>
                            <span>S</span>
                        </div>
                        <div class="calendar-grid" id="calendarGrid">
                            </div>
                    </section>
                    
                    <h2 class="section-header" id="tasksHeader">Tarefas para (Novembro 2, 2025)</h2>
                    
                    <section class="task-list" id="taskList">
                        <div class="task-item urgent" data-date="2025-11-02" data-due="4 dias" data-priority="urgent" data-status="pending" data-description="Tarefa de Estudo / Prioridade Alta">
                            
                        
                        <div class="task-item normal" data-date="2025-11-02" data-due="Ontem" data-priority="normal" data-status="completed" data-description="Concluído!">
                            <div class="task-details">
                                <p style="text-decoration: line-through; opacity: 0.6;">Leitura: Artigo sobre IA</p>
                                <span>Concluído!</span>
                            </div>
                            <div class="task-due">
                                Ontem
                            </div>
                            <div class="task-checkbox">
                                <i class="ri-checkbox-circle-fill completed"></i>
                            </div>
                        </div>

                    </section>
                    
                    <p id="noTasksMessage" style="color: var(--color-text-faded); text-align: center; margin-top: 20px; display: none;">Nenhuma tarefa agendada para este dia.</p>


                </main>
            </div>
            
            <a href="#" class="fab" id="fabButton" aria-label="Adicionar Nova Tarefa">
                <i class="ri-add-line"></i>
            </a>
            
            <div class="modal-overlay" id="addTaskModal">
                <div class="modal-content">
                    <h3>Adicionar Nova Tarefa</h3>
                    <form id="addTaskForm">
                        <input type="text" id="taskTitle" placeholder="Título da Tarefa (ex: Prova de Matemática)" required>
                        <input type="text" id="taskDescription" placeholder="Detalhes (ex: Capítulo 3)" required>
                        <input type="date" id="taskDate" required>
                        <select id="taskPriority" required>
                            <option value="normal">Prioridade: Normal</option>
                            <option value="important">Prioridade: Importante</option>
                            <option value="urgent">Prioridade: Urgente</option>
                        </select>
                        <div class="button-group">
                            <button type="button" class="btn-cancel" id="closeModal">Cancelar</button>
                            <button type="submit" class="btn-add">Adicionar</button>
                        </div>
                    </form>
                </div>
            </div>
            
        </div>
    </div>
    
    <script>
        const monthNames = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
        const dayNames = ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "Sáb"];
        const today = new Date();
        let currentMonth = today.getMonth();
        let currentYear = today.getFullYear();
        let selectedDate = new Date(); // Inicialmente seleciona a data de hoje
        
        const calendarGrid = document.getElementById('calendarGrid');
        const currentMonthYear = document.getElementById('currentMonthYear');
        const tasksHeader = document.getElementById('tasksHeader');
        const taskList = document.getElementById('taskList');
        const noTasksMessage = document.getElementById('noTasksMessage');
        const fabButton = document.getElementById('fabButton');
        const addTaskModal = document.getElementById('addTaskModal');
        const closeModal = document.getElementById('closeModal');
        const addTaskForm = document.getElementById('addTaskForm');
        const taskDateInput = document.getElementById('taskDate');

        // Simulação de Dados de Tarefas (Para persistir localmente)
        // Tentamos carregar do localStorage ou usar os exemplos iniciais
        let tasks = JSON.parse(localStorage.getItem('agendaTasks')) || [
            { title: 'Revisão de Capítulo 5 (Biologia)', description: 'Tarefa de Estudo / Prioridade Alta', date: '2025-11-02', priority: 'urgent', status: 'pending', dueText: '4 dias' },
            { title: 'Entrega Projeto de História', description: 'Trabalho Escolar', date: '2025-11-03', priority: 'important', status: 'pending', dueText: '1 semana' },
            { title: 'Leitura: Artigo sobre IA', description: 'Concluído!', date: '2025-11-02', priority: 'normal', status: 'completed', dueText: 'Ontem' },
            { title: 'Agendar horário de estudo com o Chat', description: 'Lembrete', date: '2025-11-18', priority: 'normal', status: 'pending', dueText: '2 semanas' },
            { title: 'Fazer Quiz de Geografia', description: 'Revisão dos capítulos 1 e 2', date: '2025-11-25', priority: 'important', status: 'pending', dueText: '3 semanas' },
        ];

        // Salva as tarefas no LocalStorage
        function saveTasks() {
            localStorage.setItem('agendaTasks', JSON.stringify(tasks));
        }

        // --- FUNÇÕES DE DATA E CALENDÁRIO ---
        
        // Retorna o dia formatado (YYYY-MM-DD)
        function formatDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }
        
        // Retorna o texto formatado (Ex: 'Novembro 2, 2025')
        function getReadableDate(dateString) {
            const date = new Date(dateString + 'T00:00:00'); // Adiciona T00:00:00 para evitar problemas de fuso horário
            return `${monthNames[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
        }

        // Calcula quantos dias faltam
        function calculateDueText(taskDateString) {
            const taskDate = new Date(taskDateString + 'T00:00:00');
            const now = new Date();
            now.setHours(0, 0, 0, 0); // Zera hora para comparação de dias
            
            const diffTime = taskDate.getTime() - now.getTime();
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'Hoje';
            if (diffDays === 1) return 'Amanhã';
            if (diffDays === -1) return 'Ontem';
            if (diffDays > 1) return `${diffDays} dias`;
            if (diffDays < -1) return `${Math.abs(diffDays)} dias atrás`;
            return '';
        }


        // Renderiza o Calendário
        function renderCalendar() {
            calendarGrid.innerHTML = '';
            
            const firstDayOfMonth = new Date(currentYear, currentMonth, 1);
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const startDayOfWeek = firstDayOfMonth.getDay(); // 0 (Dom) a 6 (Sáb)
            
            currentMonthYear.textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            // Dias do mês anterior para preencher o início
            const prevMonthDays = new Date(currentYear, currentMonth, 0).getDate();
            for (let i = startDayOfWeek; i > 0; i--) {
                const dayCell = document.createElement('span');
                dayCell.classList.add('day-cell', 'other-month');
                dayCell.textContent = prevMonthDays - i + 1;
                calendarGrid.appendChild(dayCell);
            }

            // Dias do mês atual
            for (let day = 1; day <= daysInMonth; day++) {
                const dateString = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                const dayCell = document.createElement('span');
                dayCell.classList.add('day-cell');
                dayCell.textContent = day;
                dayCell.setAttribute('data-date', dateString);
                
                // Checa se tem evento
                const hasEvent = tasks.some(task => task.date === dateString && task.status === 'pending');
                if (hasEvent) {
                    dayCell.classList.add('has-event');
                }
                
                // Marca o dia selecionado
                if (dateString === formatDate(selectedDate)) {
                    dayCell.classList.add('selected');
                }
                
                // Lidar com o clique no dia
                dayCell.addEventListener('click', () => {
                    // Remove a seleção anterior
                    document.querySelectorAll('.day-cell.selected').forEach(cell => cell.classList.remove('selected'));
                    // Adiciona a seleção atual
                    dayCell.classList.add('selected');
                    selectedDate = new Date(dateString + 'T00:00:00');
                    renderTasks();
                });

                calendarGrid.appendChild(dayCell);
            }

            // Dias do próximo mês para completar a grade (opcional, simplificado)
            const remainingCells = 42 - calendarGrid.children.length; // 6 semanas * 7 dias
            for (let i = 1; i <= remainingCells; i++) {
                const dayCell = document.createElement('span');
                dayCell.classList.add('day-cell', 'other-month');
                dayCell.textContent = i;
                calendarGrid.appendChild(dayCell);
            }
        }
        
        // --- FUNÇÕES DE NAVEGAÇÃO ---
        
        document.getElementById('prevMonth').addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        });
        
        document.getElementById('nextMonth').addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        });

        // --- FUNÇÕES DE TAREFAS ---
        
        // Renderiza a lista de tarefas para a data selecionada
        function renderTasks() {
            taskList.innerHTML = '';
            const selectedDateString = formatDate(selectedDate);
            tasksHeader.textContent = `Tarefas para (${getReadableDate(selectedDateString)})`;
            
            // Filtra tarefas para a data selecionada
            const filteredTasks = tasks.filter(task => task.date === selectedDateString);
            
            if (filteredTasks.length === 0) {
                noTasksMessage.style.display = 'block';
                return;
            }
            noTasksMessage.style.display = 'none';

            // Ordena por status (pendente primeiro) e depois por prioridade
            filteredTasks.sort((a, b) => {
                if (a.status === 'pending' && b.status === 'completed') return -1;
                if (a.status === 'completed' && b.status === 'pending') return 1;
                
                const priorityOrder = { 'urgent': 3, 'important': 2, 'normal': 1 };
                return priorityOrder[b.priority] - priorityOrder[a.priority];
            });

            filteredTasks.forEach(task => {
                const taskItem = document.createElement('div');
                const isCompleted = task.status === 'completed';
                
                taskItem.classList.add('task-item', task.priority);
                taskItem.setAttribute('data-date', task.date);
                taskItem.setAttribute('data-priority', task.priority);
                taskItem.setAttribute('data-status', task.status);
                
                taskItem.innerHTML = `
                    <div class="task-details">
                        <p style="${isCompleted ? 'text-decoration: line-through; opacity: 0.6;' : ''}">${task.title}</p>
                        <span>${task.description}</span>
                    </div>
                    <div class="task-due">
                        ${isCompleted ? 'Concluído' : task.dueText || calculateDueText(task.date)}
                    </div>
                    <div class="task-checkbox">
                        <i class="${isCompleted ? 'ri-checkbox-circle-fill completed' : 'ri-checkbox-blank-circle-line'}"></i>
                    </div>
                `;
                
                // Adiciona o evento de toggle no checkbox
                const checkbox = taskItem.querySelector('.task-checkbox i');
                checkbox.addEventListener('click', () => {
                    toggleTaskStatus(task);
                });
                
                taskList.appendChild(taskItem);
            });
            
            // Atualiza a contagem de tarefas no header (opcionalmente)
            //tasksHeader.textContent = `Tarefas para (${getReadableDate(selectedDateString)}) (${filteredTasks.filter(t => t.status === 'pending').length} pendentes)`;
        }
        
        // Altera o status da tarefa
        function toggleTaskStatus(taskToUpdate) {
            taskToUpdate.status = taskToUpdate.status === 'pending' ? 'completed' : 'pending';
            taskToUpdate.dueText = taskToUpdate.status === 'completed' ? 'Concluído agora!' : calculateDueText(taskToUpdate.date);
            saveTasks();
            renderTasks(); // Renderiza a lista novamente
            renderCalendar(); // Atualiza o calendário (para remover a marcação has-event se for a última pendente)
        }

        // --- FUNÇÕES DO MODAL/FORMULÁRIO ---
        
        // Abrir Modal
        fabButton.addEventListener('click', (e) => {
            e.preventDefault();
            // Pré-preenche a data com a data selecionada no calendário
            taskDateInput.value = formatDate(selectedDate);
            addTaskModal.classList.add('active');
        });

        // Fechar Modal
        closeModal.addEventListener('click', () => {
            addTaskModal.classList.remove('active');
        });

        // Adicionar Tarefa
        addTaskForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const newTitle = document.getElementById('taskTitle').value;
            const newDescription = document.getElementById('taskDescription').value;
            const newDate = document.getElementById('taskDate').value;
            const newPriority = document.getElementById('taskPriority').value;

            const newTask = {
                title: newTitle,
                description: newDescription,
                date: newDate,
                priority: newPriority,
                status: 'pending',
                dueText: calculateDueText(newDate)
            };
            
            tasks.push(newTask);
            saveTasks();

            // Seta a data da nova tarefa como selecionada e renderiza
            selectedDate = new Date(newDate + 'T00:00:00');
            currentMonth = selectedDate.getMonth();
            currentYear = selectedDate.getFullYear();
            
            renderCalendar();
            renderTasks();
            
            addTaskModal.classList.remove('active');
            addTaskForm.reset();
        });


        // --- INICIALIZAÇÃO ---
        
        // Se for a primeira vez, garante que o dia 2 do exemplo esteja selecionado
        selectedDate = new Date('2025-11-02T00:00:00');
        currentMonth = selectedDate.getMonth();
        currentYear = selectedDate.getFullYear();

        // Inicia a renderização
        renderCalendar();
        renderTasks();
    </script>
</body>

</html>