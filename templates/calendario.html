<!DOCTYPE html>
<html lang="pt-br">

<head>
<meta charset="utf-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0095FF">

<title>Agenda | Brain Boost</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.4.47/css/materialdesignicons.min.css">

<style>
/* ======================== */
/* === CORE E VARI√ÅVEIS === */
/* ======================== */
:root {
    --color-dark: #0A1428; /* Fundo Principal */
    --color-medium-blue: #1A345C; /* Card/Container/Toolbar */
    --color-accent: #00A6FF; /* Principal (Acento) */
    --color-yellow: #FFC74F; 
    --color-green: #27AE60; 
    --color-red: #E74C3C; /* Erro/Urgente */
    --color-white: #FFFFFF;
    --color-text-light: rgba(255, 255, 255, 0.95);
    --color-muted: rgba(255, 255, 255, 0.5); /* Texto Secund√°rio */
    --radius: 14px;
    --font: 'Poppins', sans-serif;
}

body {
    background: var(--color-dark);
    margin: 0;
    color: var(--color-text-light);
    padding-bottom: 95px;
    font-family: var(--font);
    line-height: 1.4;
    -webkit-font-smoothing: antialiased;
}

/* GERAL */
a { text-decoration: none; color: var(--color-accent); transition: opacity 0.2s; }
a:active { opacity: 0.8; }

/* HEADER */
.top-nav {
    height: 80px; /* Mais baixo */
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding: 0 20px;
    position: relative;
    margin-top: 5px;
}
.logo-app {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
}
.logo-app img { width: 120px; filter: drop-shadow(0 0 5px rgba(0, 166, 255, 0.2)); }
.btn-acao-topo i { 
    color: var(--color-accent); 
    font-size: 28px; 
    margin-left: 15px; 
    transition: color 0.2s;
}
.btn-acao-topo .ri-logout-box-r-line { color: var(--color-red); }

/* PAGE CONTENT */
.page-content { 
    width: min(92%, 520px); 
    margin: 0 auto; 
    padding-top: 15px; 
}
h1 { 
    text-align: center; 
    font-size: 1.6rem; 
    margin: 15px 0 30px; 
    font-weight: 700;
}

/* ======================== */
/* ======= CALEND√ÅRIO ======= */
/* ======================== */
.calendar-container {
    background: var(--color-medium-blue);
    border-radius: var(--radius);
    padding: 20px;
    margin-bottom: 30px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}
.calendar-header {
    display: flex; justify-content: space-between; align-items: center;
    font-weight: 600; margin-bottom: 20px;
    font-size: 1.1rem;
}
.calendar-header i {
    color: var(--color-accent); cursor: pointer; font-size: 26px;
    transition: transform 0.1s;
}
.calendar-header i:active { transform: scale(0.9); }

.calendar-days-name, .calendar-grid {
    display: grid; 
    grid-template-columns: repeat(7, 1fr); 
    text-align: center;
}
.calendar-days-name { 
    font-size: 0.75rem; 
    color: var(--color-muted); 
    margin-bottom: 10px; 
    font-weight: 600;
}
.day-cell {
    aspect-ratio: 1 / 1;
    display: flex; 
    justify-content: center; 
    align-items: center;
    border-radius: 50%;
    font-size: 15px; 
    cursor: pointer; 
    transition: all .2s;
    position: relative;
}
.day-cell:hover { background: rgba(255,255,255,0.08); }
.day-cell.other-month { opacity: .2; pointer-events: none; }

/* Indicador de evento mais discreto */
.day-cell.has-event::after {
    content:""; 
    width:5px; 
    height:5px; 
    border-radius:50%;
    background: var(--color-yellow); 
    position:absolute; 
    bottom:2px;
}

.day-cell.selected {
    background: var(--color-accent); 
    color: var(--color-dark); 
    font-weight:700;
    box-shadow: 0 0 10px rgba(0, 166, 255, 0.5);
}
.day-cell.selected.has-event::after {
    background: var(--color-dark); /* Ponto escuro no dia selecionado */
}

/* ======================== */
/* ======== TAREFAS ========= */
/* ======================== */
.section-header { 
    margin: 25px 0 15px; 
    font-size: 1.2rem; 
    font-weight: 600; 
    color: var(--color-text-light);
}
.task-list { 
    display: flex; 
    flex-direction: column; 
    gap: 15px; /* Mais espa√ßo entre tarefas */
}
.task-item {
    background: var(--color-medium-blue); 
    padding: 16px;
    border-radius: 10px; /* Ligeiramente menos arredondado */
    display: flex; 
    justify-content: space-between; 
    align-items:center;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    transition: background 0.2s;
}
.task-item:active { transform: scale(0.99); }

.task-details { flex-grow: 1; margin-right: 10px; }
.task-details p { 
    margin: 0; 
    font-weight: 600; 
    font-size: 1rem;
    color: var(--color-text-light);
}
.task-details span { 
    font-size: .8rem; 
    color: var(--color-muted); 
    display: block; 
    margin-top: 2px;
}
.task-due { 
    font-size: .85rem; 
    font-weight: 600; 
    color: var(--color-yellow); 
    min-width: 80px; 
    text-align: right;
    margin-right: 15px;
}
.task-checkbox i { 
    font-size: 26px; 
    cursor: pointer; 
    color: var(--color-muted); 
    transition: color 0.2s;
}
.task-checkbox i:hover { color: var(--color-accent); }

/* Indicador de Prioridade mais discreto (cor na checkbox) */
.task-item.urgent .task-checkbox i { color: var(--color-red); }
.task-item.important .task-checkbox i { color: var(--color-yellow); }
.task-item.normal .task-checkbox i { color: var(--color-green); }

.task-item[data-status="completed"] { 
    opacity: 0.7; 
    background: #112644; 
}
.task-item[data-status="completed"] p { 
    text-decoration: line-through; 
    color: var(--color-muted);
}
.task-item[data-status="completed"] .task-due { 
    color: var(--color-muted); 
}
.task-item[data-status="completed"] .task-checkbox i {
    color: var(--color-green) !important;
}

#noTasksMessage { 
    margin-top: 30px; 
    font-style: italic; 
    font-size: 0.9rem;
}

/* ======================== */
/* ========= FAB ========== */
/* ======================== */
.fab {
    position: fixed; 
    right: 25px; 
    bottom: 100px; /* Mais alto, longe da toolbar */
    width: 60px; 
    height: 60px; 
    border-radius: 50%;
    display: flex; 
    justify-content: center; 
    align-items: center;
    background: var(--color-accent); 
    color: var(--color-dark);
    font-size: 30px; 
    cursor: pointer; 
    box-shadow: 0 4px 15px rgba(0, 166, 255, 0.5);
    transition: transform 0.1s, box-shadow 0.2s;
    z-index: 50;
}
.fab:active { transform: scale(0.95); box-shadow: 0 2px 8px rgba(0, 166, 255, 0.4); }


/* ======================== */
/* ======== MODAL ========= */
/* ======================== */
.modal-overlay { 
    position:fixed; 
    inset:0; 
    background: rgba(0, 0, 0, 0.7); /* Fundo escuro */
    backdrop-filter:blur(8px); 
    display:none; 
    z-index: 100;
}
.modal-overlay.active { display:flex; justify-content:center; align-items:center; }
.modal-content {
    background: var(--color-medium-blue); 
    padding: 25px; 
    border-radius: 20px;
    width: min(90%, 400px);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
    transform: scale(0.9);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.modal-overlay.active .modal-content {
    transform: scale(1);
    opacity: 1;
}

.modal-content h3 { 
    margin-top: 0; 
    font-size: 1.5rem; 
    font-weight: 700; 
    margin-bottom: 20px;
    text-align: center;
}
.modal-content input, 
.modal-content select {
    width: 100%; 
    background: #0d1e3a; /* Cor de fundo para input */
    border: 1px solid rgba(255,255,255,.1); 
    border-radius: 10px;
    padding: 12px; 
    margin-top: 10px;
    color: var(--color-text-light); 
    font-size: 1rem;
    appearance: none; /* Remove seta padr√£o em selects */
}
.modal-content select {
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ffffff'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 10px top 50%;
    background-size: 18px;
    padding-right: 30px;
}
.modal-content input:focus, .modal-content select:focus {
    border-color: var(--color-accent);
    outline: none;
    box-shadow: 0 0 5px rgba(0, 166, 255, 0.5);
}

.modal-content button { 
    margin-top: 20px; 
    padding: 14px; 
    width: 100%; 
    border: none; 
    border-radius: 10px; 
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s, transform 0.1s;
}
.btn-add { 
    background: var(--color-accent); 
    color: var(--color-dark); 
}
.btn-add:active { transform: scale(0.98); }
.btn-cancel { 
    background: #3a5a7f; 
    color: var(--color-white); 
    margin-top: 10px;
}
.btn-cancel:active { transform: scale(0.98); }


/* ======================== */
/* ======== NAVBAR ======== */
/* ======================== */
.toolbar-bottom { 
    position:fixed; 
    bottom:0; 
    width:100%; 
    padding:10px; 
    background:transparent; 
    z-index: 100;
}
.toolbar-inner {
    background: var(--color-medium-blue); 
    border-radius: 50px; 
    height: 70px; /* Mais alto */
    display:flex; 
    justify-content:space-around; 
    align-items:center;
    box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.4);
    margin: 0 8px;
}
.toolbar-link { 
    color: var(--color-muted); 
    text-align:center; 
    font-size:.7rem; 
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 5px 0;
    transition: color 0.2s;
}
.toolbar-link i { 
    font-size: 26px; /* √çcones maiores */
    margin-bottom: 2px; 
    line-height: 1;
}
.toolbar-link.active { 
    color: var(--color-accent); 
    font-weight: 600; 
    filter: drop-shadow(0 0 5px rgba(0, 166, 255, 0.4));
}
</style>
</head>


<body>
<header class="top-nav">
    <div class="logo-app"><img src="https://i.postimg.cc/3w4kZB8V/logo.png" alt="Brain Boost Logo"></div>
    <div class="btn-acao-topo">
        <a href="{{ url_for('editar_usuario', id_usuario=current_user.id_usuario) }}" aria-label="Editar Perfil"><i class="mdi mdi-account"></i></a>
        <a href="{{ url_for('logout') }}" aria-label="Sair"><i class="ri-logout-box-r-line"></i></a>
    </div>
</header>

<main class="page-content">

<h1><i class="ri-calendar-todo-fill"></i> Minha Agenda</h1>

<section class="calendar-container">
    <div class="calendar-header">
        <i class="ri-arrow-left-s-line" id="prevMonth"></i>
        <span id="currentMonthYear"></span>
        <i class="ri-arrow-right-s-line" id="nextMonth"></i>
    </div>

    <div class="calendar-days-name">
        <span>D</span><span>S</span><span>T</span><span>Q</span><span>Q</span><span>S</span><span>S</span>
    </div>

    <div class="calendar-grid" id="calendarGrid"></div>
</section>

<h2 class="section-header" id="tasksHeader"></h2>
<section class="task-list" id="taskList"></section>
<p id="noTasksMessage" style="text-align:center; color:var(--color-muted); display:none;">üéâ Sem tarefas para o dia selecionado!</p>

</main>

<div class="fab" id="fabButton" role="button" aria-label="Adicionar Nova Tarefa"><i class="ri-add-line"></i></div>

<div class="modal-overlay" id="addTaskModal">
    <div class="modal-content">
        <h3>Nova Tarefa</h3>
        <form id="addTaskForm">
            <input type="text" id="taskTitle" placeholder="T√≠tulo da Tarefa" required>
            <input type="text" id="taskDescription" placeholder="Detalhes ou Descri√ß√£o" required>
            <input type="date" id="taskDate" required>
            <select id="taskPriority" required>
                <option value="normal">Prioridade: Normal</option>
                <option value="important">Prioridade: Importante</option>
                <option value="urgent">Prioridade: Urgente</option>
            </select>
            <button type="submit" class="btn-add">Adicionar Tarefa</button>
            <button type="button" class="btn-cancel" id="closeModal">Cancelar</button>
        </form>
    </div>
</div>

<footer class="toolbar-bottom">
<nav class="toolbar-inner">
    <a href="{{ url_for('inicio') }}" class="toolbar-link"><i class="ri-home-5-fill"></i>Home</a>
    <a href="{{ url_for('chattodos') }}" class="toolbar-link"><i class="ri-chat-3-fill"></i>Chat</a>
    <a href="{{ url_for('quizboost') }}" class="toolbar-link"><i class="ri-gamepad-fill"></i>Quiz</a>
    
    <a href="{{ url_for('relaxar') }}" class="toolbar-link"><i class="ri-timer-2-fill"></i>Relaxar</a>
</nav>
</footer>

<script>
// Mantido o script original, que j√° estava funcional, apenas com pequenas melhorias
const monthNames = ["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
let selectedDate = new Date();
let currentMonth = selectedDate.getMonth();
let currentYear = selectedDate.getFullYear();

let tasks = JSON.parse(localStorage.getItem("agendaTasks")) || [];
let nextId = tasks.length ? Math.max(...tasks.map(t => t.id)) + 1 : 1;

const calendarGrid = document.getElementById("calendarGrid");
const currentMonthYear = document.getElementById("currentMonthYear");
const taskList = document.getElementById("taskList");
const tasksHeader = document.getElementById("tasksHeader");
const noTasksMessage = document.getElementById("noTasksMessage");

function saveTasks(){ localStorage.setItem("agendaTasks", JSON.stringify(tasks)); }
function formatDate(date){ 
    // Garante que a data est√° no formato YYYY-MM-DD
    const d = new Date(date);
    d.setMinutes(d.getMinutes() - d.getTimezoneOffset()); // Ajusta fuso hor√°rio para consist√™ncia
    return d.toISOString().split("T")[0]; 
}

function renderCalendar(){
    calendarGrid.innerHTML="";
    currentMonthYear.textContent = `${monthNames[currentMonth]} ${currentYear}`;

    const first = new Date(currentYear,currentMonth,1);
    const daysInMonth=new Date(currentYear,currentMonth+1,0).getDate();
    const start=first.getDay();

    for(let i=0;i<start;i++){
        let cell=document.createElement("span");
        cell.className="day-cell other-month";
        calendarGrid.appendChild(cell);
    }

    for(let d=1;d<=daysInMonth;d++){
        // Cria a string da data no formato correto
        const dateStr=`${currentYear}-${String(currentMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const cell=document.createElement("span");
        cell.className="day-cell";
        cell.textContent=d;
        cell.dataset.date=dateStr;

        // Verifica eventos e sele√ß√£o
        if(tasks.some(t=>t.date==dateStr && t.status=="pending")) cell.classList.add("has-event");
        
        // Compara apenas a string formatada da data selecionada
        if(formatDate(selectedDate)==dateStr) cell.classList.add("selected");

        cell.onclick=()=>{ 
            selectedDate=new Date(dateStr + "T00:00:00"); // Garante que a hora √© 00:00
            renderCalendar(); 
            renderTasks(); 
        };
        calendarGrid.appendChild(cell);
    }
}

function calculateDue(date){
    const now=new Date(); now.setHours(0,0,0,0);
    const t=new Date(date + "T00:00:00"); // Garante que a compara√ß√£o √© no mesmo hor√°rio
    const diff=Math.round((t-now)/(1000*60*60*24));
    if(diff===0)return"Hoje"; 
    if(diff===1)return"Amanh√£"; 
    if(diff===-1)return"Ontem";
    return diff>0?`Em ${diff} dias`:`Atrasado: ${Math.abs(diff)}d`; // Retorno mais profissional
}

function renderTasks(){
    const date=formatDate(selectedDate);
    
    // Formata o t√≠tulo da se√ß√£o de tarefas
    const day = selectedDate.getDate();
    const month = monthNames[selectedDate.getMonth()].substring(0, 3);
    tasksHeader.textContent=`Tarefas de ${day} de ${month}`;

    const filtered=tasks.filter(t=>t.date==date);
    taskList.innerHTML="";
    if(filtered.length==0){ noTasksMessage.style.display="block"; return; }
    noTasksMessage.style.display="none";

    // Ordena√ß√£o: Pendente > Prioridade Alta > Conclu√≠do
    filtered.sort((a,b)=>{
        if(a.status=="completed" && b.status!="completed") return 1;
        if(a.status!="completed" && b.status=="completed") return -1;
        const pA = {urgent:3,important:2,normal:1}[a.priority];
        const pB = {urgent:3,important:2,normal:1}[b.priority];
        return pB - pA;
    });

    filtered.forEach(task=>{
        const item=document.createElement("div");
        item.className=`task-item ${task.priority}`;
        item.dataset.status=task.status;
        item.innerHTML=`
            <div class="task-details"><p>${task.title}</p><span>${task.description}</span></div>
            <div class="task-due">${task.status=="completed"?"Conclu√≠do":calculateDue(task.date)}</div>
            <div class="task-checkbox"><i class="${task.status=="completed"?"ri-checkbox-circle-fill":"ri-checkbox-blank-circle-line"}"></i></div>
        `;
        item.querySelector(".task-checkbox i").onclick=()=>{
            task.status=task.status=="completed"?"pending":"completed";
            saveTasks(); renderTasks(); renderCalendar();
        };
        taskList.appendChild(item);
    });
}

document.getElementById("prevMonth").onclick=()=>{ 
    currentMonth--; 
    if(currentMonth<0){currentMonth=11; currentYear--;} 
    renderCalendar(); 
};
document.getElementById("nextMonth").onclick=()=>{ 
    currentMonth++; 
    if(currentMonth>11){currentMonth=0; currentYear++;} 
    renderCalendar(); 
};

// Garante que o selectedDate √© o dia de hoje ao carregar
selectedDate = new Date(formatDate(new Date()) + "T00:00:00");
currentMonth = selectedDate.getMonth();
currentYear = selectedDate.getFullYear();

renderCalendar(); renderTasks();

// MODAL
const fab=document.getElementById("fabButton");
const modal=document.getElementById("addTaskModal");
const close=document.getElementById("closeModal");
const taskTitle = document.getElementById("taskTitle");
const taskDescription = document.getElementById("taskDescription");
const taskDate = document.getElementById("taskDate");
const taskPriority = document.getElementById("taskPriority");

fab.onclick=()=>{ 
    modal.classList.add("active"); 
    // Pr√©-preenche a data selecionada e limpa os campos
    taskDate.value=formatDate(selectedDate);
    taskTitle.value = '';
    taskDescription.value = '';
    taskPriority.value = 'normal';
    taskTitle.focus();
};
close.onclick=()=>modal.classList.remove("active");

document.getElementById("addTaskForm").onsubmit=e=>{
    e.preventDefault();
    
    // Valida√ß√£o b√°sica para evitar erros
    if (!taskTitle.value || !taskDescription.value || !taskDate.value) {
        alert("Por favor, preencha todos os campos.");
        return;
    }

    tasks.push({
        id:nextId++,
        title:taskTitle.value,
        description:taskDescription.value,
        date:taskDate.value,
        priority:taskPriority.value,
        status:"pending"
    });
    saveTasks(); 
    modal.classList.remove("active"); 
    
    // Se a tarefa adicionada for para o dia atual/selecionado, atualiza as listas
    if(taskDate.value === formatDate(selectedDate)) {
        renderTasks();
    }
    renderCalendar();
};
</script>

</body>
</html>